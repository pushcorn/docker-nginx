{{#+from.fqdn}}
{{#?from.ssl}}
map $ssl_preread_server_name ${{name}}_upstream {
    {{from.fqdn}} {{to.fqdn}}:{{to.port}};
}
{{:}}
map $hostname ${{name}}_upstream {
    {{from.fqdn}} {{to.fqdn}}:{{to.port}};
}
{{/}}
{{/}}

server {
    listen {{from.port}};
    proxy_pass ${{name}}_upstream;
    {{#? proxy.protocol}}
    proxy_protocol on;
    {{/}}
    {{#?from.ssl}}
    ssl_preread on;
    {{/}}
    {{#resolver}}
    resolver {{.}} valid=30s;
    {{/}}

    access_log  /var/log/nginx/{{from.fqdn}}-stream-access.log log_stream{{#?from.ssl}}_ssl{{/}};
    error_log   /var/log/nginx/{{from.fqdn}}-stream-error.log warn;

}
